/*!/*@nomin*/
"use strict";var dr=Object.defineProperty,gr=Object.defineProperties;var mr=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var pr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable;var H=(n,e,t)=>e in n?dr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,B=(n,e)=>{for(var t in e||(e={}))pr.call(e,t)&&H(n,t,e[t]);if(Se)for(var t of Se(e))fr.call(e,t)&&H(n,t,e[t]);return n},K=(n,e)=>gr(n,mr(e));var E=(n,e,t)=>H(n,typeof e!="symbol"?e+"":e,t);var I=(n,e,t)=>new Promise((a,o)=>{var i=c=>{try{s(t.next(c))}catch(l){o(l)}},u=c=>{try{s(t.throw(c))}catch(l){o(l)}},s=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,u);s((t=t.apply(n,e)).next())});const r=require("vue"),N=require("vuex"),k=require("@wikimedia/codex"),hr={action:"wbsearchentities",type:"item",limit:"10"};function vr(n){return n.search.map(e=>({id:e.id,display:e.display}))}class yr{constructor(e,t){E(this,"api");E(this,"languageCode");this.api=e,this.languageCode=t}searchItems(o,i){return I(this,arguments,function*(e,t,a={}){const u=yield this.api.get(B(K(B({},hr),{search:e,language:this.languageCode,continue:t}),a));return vr(u)})}}class br{constructor(e,t){this.getUrl=e,this.lexemeNamespaceId=t}getSearchUrlForLexeme(e){return this.getUrl("Special:Search",{search:e,[`ns${this.lexemeNamespaceId}`]:1})}}class xr{constructor(e){this.trackFunction=e}increment(e){this.trackFunction(`counter.MediaWiki.${e}`,1)}}const We=Symbol("ItemSearch");function _r(){return r.inject(We,()=>{throw new Error("No ItemSearcher provided!")},!0)}const He=Symbol("Config");function A(){return r.inject(He,()=>{throw new Error("No Config provided!")},!0)}const Ke=Symbol("SearchLinker");function wr(){return r.inject(Ke,()=>{throw new Error("No SearchLinker provided!")},!0)}const Xe=Symbol("AuthenticationLinker");function Sr(){return r.inject(Xe,()=>{throw new Error("No AuthenticationLinker provided!")},!0)}const he="setLemma",pe="setLanguage",ve="setLanguageSearchInput",ye="setLexicalCategory",be="setLexicalCategorySearchInput",D="setSpellingVariant",xe="setSpellingVariantSearchInput",fe="setLanguageCodeFromLanguageItem",Ye="addErrors",q="addPerFieldError",P="clearPerFieldErrors",Je="clearErrors",Er={[he](n,e){n.lemma=e},[pe](n,e){n.language=e},[ve](n,e){n.languageSearchInput=e},[ye](n,e){n.lexicalCategory=e},[be](n,e){n.lexicalCategorySearchInput=e},[D](n,e){n.spellingVariant=e},[xe](n,e){n.spellingVariantSearchInput=e},[fe](n,e){n.languageCodeFromLanguageItem=e},[Ye](n,e){n.globalErrors.push(...e)},[q](n,e){n.perFieldErrors[e.field].push(e.error)},[P](n,e){n.perFieldErrors[e]=[]},[Je](n){n.globalErrors=[]}},Qe="createLexeme",ze="handleLanguageChange",Ze="initFromParams",X="handleItemLanguageCode",Ee="assembleValidInputs";function Lr(n,e,t,a){return{[Ee]({state:i,commit:u}){const s={};if(i.lemma?s.validLemma=i.lemma:u(q,{field:"lemmaErrors",error:{messageKey:"wikibaselexeme-newlexeme-lemma-empty-error"}}),i.language)s.validLanguageId=i.language.id;else{let l;i.languageSearchInput?l="wikibaselexeme-newlexeme-language-invalid-error":l="wikibaselexeme-newlexeme-language-empty-error",u(q,{field:"languageErrors",error:{messageKey:l}})}if(i.lexicalCategory)s.validLexicalCategoryId=i.lexicalCategory.id;else{let l;i.lexicalCategorySearchInput?l="wikibaselexeme-newlexeme-lexicalcategory-invalid-error":l="wikibaselexeme-newlexeme-lexicalcategory-empty-error",u(q,{field:"lexicalCategoryErrors",error:{messageKey:l}})}if(i.language)if(i.spellingVariant)s.validSpellingVariant=i.spellingVariant;else if(i.languageCodeFromLanguageItem)s.validSpellingVariant=i.languageCodeFromLanguageItem;else{let l;i.spellingVariantSearchInput?l="wikibaselexeme-newlexeme-lemma-language-invalid-error":l="wikibaselexeme-newlexeme-lemma-language-empty-error",u(q,{field:"spellingVariantErrors",error:{messageKey:l}})}if(!(l=>!!l.validLemma&&!!l.validLanguageId&&!!l.validLexicalCategoryId&&!!l.validSpellingVariant)(s))throw new Error("Not all fields are valid");return s},[Qe](s){return I(this,arguments,function*({commit:i,dispatch:u}){const{validLemma:c,validLanguageId:l,validLexicalCategoryId:m,validSpellingVariant:g}=yield u(Ee);i(Je);try{const p=yield n.createLexeme(c,g,l,m);return a.increment("wikibase.lexeme.special.NewLexeme.js.create"),p}catch(p){return i(Ye,p),Promise.reject(null)}})},[ze](l,m){return I(this,arguments,function*({state:i,commit:u,dispatch:s},c){const g=i.language;if(u(pe,c),(g==null?void 0:g.id)===(c==null?void 0:c.id)||(u(fe,void 0),u(D,""),!c))return;const p=yield e.getLanguageCodeFromItem(c.id);yield s(X,p)})},[Ze](c,l){return I(this,arguments,function*({commit:i,dispatch:u},s){var m,g,p,v;s.lemma!==void 0&&i(he,s.lemma),s.spellVarCode!==void 0&&(i(D,s.spellVarCode),i(xe,s.spellVarCode)),s.language!==void 0&&(i(pe,{id:s.language.id,display:s.language.display}),yield u(X,s.language.languageCode),i(ve,(g=(m=s.language.display.label)==null?void 0:m.value)!=null?g:s.language.id)),s.lexicalCategory!==void 0&&(i(ye,s.lexicalCategory),i(be,(v=(p=s.lexicalCategory.display.label)==null?void 0:p.value)!=null?v:s.lexicalCategory.id))})},[X](s,c){return I(this,arguments,function*({commit:i},u){typeof u=="string"&&(u=u.toLowerCase()),typeof u=="string"&&!t.isValid(u)&&(u=!1),i(fe,u)})}}}function Ir({lexemeCreator:n,langCodeRetriever:e,languageCodesProvider:t,tracker:a}){return N.createStore({state(){return{lemma:"",language:null,languageSearchInput:"",languageCodeFromLanguageItem:void 0,lexicalCategory:null,lexicalCategorySearchInput:"",spellingVariant:"",spellingVariantSearchInput:"",globalErrors:[],perFieldErrors:{lemmaErrors:[],languageErrors:[],lexicalCategoryErrors:[],spellingVariantErrors:[]}}},mutations:Er,actions:Lr(n,e,t,a)})}const kr=r.defineComponent({__name:"WarningMessage",setup(n){return(e,t)=>(r.openBlock(),r.createBlock(r.unref(k.CdxMessage),{type:"warning"},{default:r.withCtx(()=>[r.renderSlot(e.$slots,"default")]),_:3}))}});class er{constructor(e){E(this,"messagesRepository");if(!e){this.messagesRepository={get(t){return`⧼${t}⧽`},getText(t){return`⧼${t}⧽`}};return}this.messagesRepository=e}get(e,...t){return this.messagesRepository.get(e,...t)}getUnescaped(e,...t){return this.messagesRepository.getText(e,...t)}}const rr=Symbol("Messages");function T(){return r.inject(rr,new er)}const Cr=["innerHTML"],Tr=r.defineComponent({__name:"AnonymousEditWarning",setup(n){const e=Sr(),t=T(),a=A();let o="wikibase-anonymouseditwarning";a.tempUserEnabled&&(o="wikibase-anonymouseditnotificationtempuser");const i=r.computed(()=>t.get(o,e.getLoginLink(),e.getCreateAccountLink()));return(u,s)=>r.unref(a).isAnonymous?(r.openBlock(),r.createBlock(kr,{key:0,class:"wbl-snl-anonymous-edit-warning"},{default:r.withCtx(()=>[r.createElementVNode("span",{innerHTML:i.value},null,8,Cr)]),_:1})):r.createCommentVNode("",!0)}}),O=(n,e)=>{const t=n.__vccOpts||n;for(const[a,o]of e)t[a]=o;return t},Rr=O(Tr,[["__scopeId","data-v-1a7220a5"]]),Vr=["title"],Nr=r.defineComponent({__name:"RequiredAsterisk",setup(n){const e=T();return(t,a)=>(r.openBlock(),r.createElementBlock("span",{class:"wbl-snl-required-asterisk","aria-hidden":"true",title:r.unref(e).getUnescaped("wikibaselexeme-form-field-required")},"*",8,Vr))}}),j=O(Nr,[["__scopeId","data-v-7e8ebec0"]]),Ur=r.defineComponent({__name:"LemmaInput",props:{modelValue:{}},emits:["update:modelValue"],setup(n){const e=n,t=T(),a=A(),o=a.placeholderExampleData.lemma,i=N.useStore(),u=r.computed(()=>Array.from(e.modelValue).length>a.maxLemmaLength?{status:"error",messages:{error:t.getUnescaped("wikibaselexeme-newlexeme-lemma-too-long-error",a.maxLemmaLength.toString())}}:i.state.perFieldErrors.lemmaErrors.length?{status:"error",messages:{error:t.getUnescaped(i.state.perFieldErrors.lemmaErrors[0].messageKey)}}:{status:"default",messages:{}});return(s,c)=>(r.openBlock(),r.createBlock(r.unref(k.CdxField),{class:"wbl-snl-lemma-input",status:u.value.status,messages:u.value.messages},{label:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(r.unref(t).getUnescaped("wikibaselexeme-newlexeme-lemma")),1),r.createVNode(j)]),default:r.withCtx(()=>[r.createVNode(r.unref(k.CdxTextInput),{placeholder:r.unref(t).getUnescaped("wikibaselexeme-newlexeme-lemma-placeholder-with-example",r.unref(o)),name:"lemma","aria-required":"true","model-value":s.modelValue,"onUpdate:modelValue":c[0]||(c[0]=l=>s.$emit("update:modelValue",l))},null,8,["placeholder","model-value"])]),_:1},8,["status","messages"]))}});var G=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function tr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Y,Le;function nr(){if(Le)return Y;Le=1;function n(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}return Y=n,Y}var J,Ie;function Ar(){if(Ie)return J;Ie=1;var n=typeof G=="object"&&G&&G.Object===Object&&G;return J=n,J}var Q,ke;function ar(){if(ke)return Q;ke=1;var n=Ar(),e=typeof self=="object"&&self&&self.Object===Object&&self,t=n||e||Function("return this")();return Q=t,Q}var z,Ce;function Mr(){if(Ce)return z;Ce=1;var n=ar(),e=function(){return n.Date.now()};return z=e,z}var Z,Te;function Fr(){if(Te)return Z;Te=1;var n=/\s/;function e(t){for(var a=t.length;a--&&n.test(t.charAt(a)););return a}return Z=e,Z}var ee,Re;function qr(){if(Re)return ee;Re=1;var n=Fr(),e=/^\s+/;function t(a){return a&&a.slice(0,n(a)+1).replace(e,"")}return ee=t,ee}var re,Ve;function _e(){if(Ve)return re;Ve=1;var n=ar(),e=n.Symbol;return re=e,re}var te,Ne;function Pr(){if(Ne)return te;Ne=1;var n=_e(),e=Object.prototype,t=e.hasOwnProperty,a=e.toString,o=n?n.toStringTag:void 0;function i(u){var s=t.call(u,o),c=u[o];try{u[o]=void 0;var l=!0}catch(g){}var m=a.call(u);return l&&(s?u[o]=c:delete u[o]),m}return te=i,te}var ne,Ue;function Or(){if(Ue)return ne;Ue=1;var n=Object.prototype,e=n.toString;function t(a){return e.call(a)}return ne=t,ne}var ae,Ae;function jr(){if(Ae)return ae;Ae=1;var n=_e(),e=Pr(),t=Or(),a="[object Null]",o="[object Undefined]",i=n?n.toStringTag:void 0;function u(s){return s==null?s===void 0?o:a:i&&i in Object(s)?e(s):t(s)}return ae=u,ae}var se,Me;function $r(){if(Me)return se;Me=1;function n(e){return e!=null&&typeof e=="object"}return se=n,se}var oe,Fe;function sr(){if(Fe)return oe;Fe=1;var n=jr(),e=$r(),t="[object Symbol]";function a(o){return typeof o=="symbol"||e(o)&&n(o)==t}return oe=a,oe}var ie,qe;function Br(){if(qe)return ie;qe=1;var n=qr(),e=nr(),t=sr(),a=NaN,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,u=/^0o[0-7]+$/i,s=parseInt;function c(l){if(typeof l=="number")return l;if(t(l))return a;if(e(l)){var m=typeof l.valueOf=="function"?l.valueOf():l;l=e(m)?m+"":m}if(typeof l!="string")return l===0?l:+l;l=n(l);var g=i.test(l);return g||u.test(l)?s(l.slice(2),g?2:8):o.test(l)?a:+l}return ie=c,ie}var le,Pe;function Gr(){if(Pe)return le;Pe=1;var n=nr(),e=Mr(),t=Br(),a="Expected a function",o=Math.max,i=Math.min;function u(s,c,l){var m,g,p,v,y,L,C=0,R=!1,w=!1,_=!0;if(typeof s!="function")throw new TypeError(a);c=t(c)||0,n(l)&&(R=!!l.leading,w="maxWait"in l,p=w?o(t(l.maxWait)||0,c):p,_="trailing"in l?!!l.trailing:_);function b(x){var V=m,F=g;return m=g=void 0,C=x,v=s.apply(F,V),v}function S(x){return C=x,y=setTimeout(h,c),R?b(x):v}function d(x){var V=x-L,F=x-C,we=c-V;return w?i(we,p-F):we}function f(x){var V=x-L,F=x-C;return L===void 0||V>=c||V<0||w&&F>=p}function h(){var x=e();if(f(x))return M(x);y=setTimeout(h,d(x))}function M(x){return y=void 0,_&&m?b(x):(m=g=void 0,v)}function $(){y!==void 0&&clearTimeout(y),C=0,m=L=g=y=void 0}function W(){return y===void 0?v:M(e())}function U(){var x=e(),V=f(x);if(m=arguments,g=this,L=x,V){if(y===void 0)return S(L);if(w)return clearTimeout(y),y=setTimeout(h,c),b(L)}return y===void 0&&(y=setTimeout(h,c)),v}return U.cancel=$,U.flush=W,U}return le=u,le}var Dr=Gr();const Wr=tr(Dr);var ue,Oe;function Hr(){if(Oe)return ue;Oe=1;function n(e,t){for(var a=-1,o=e==null?0:e.length,i=Array(o);++a<o;)i[a]=t(e[a],a,e);return i}return ue=n,ue}var ce,je;function Kr(){if(je)return ce;je=1;var n=Array.isArray;return ce=n,ce}var de,$e;function Xr(){if($e)return de;$e=1;var n=_e(),e=Hr(),t=Kr(),a=sr(),o=1/0,i=n?n.prototype:void 0,u=i?i.toString:void 0;function s(c){if(typeof c=="string")return c;if(t(c))return e(c,s)+"";if(a(c))return u?u.call(c):"";var l=c+"";return l=="0"&&1/c==-o?"-0":l}return de=s,de}var ge,Be;function Yr(){if(Be)return ge;Be=1;var n=Xr();function e(t){return t==null?"":n(t)}return ge=e,ge}var me,Ge;function Jr(){if(Ge)return me;Ge=1;var n=Yr(),e=/[\\^$.*+?()[\]{}|]/g,t=RegExp(e.source);function a(o){return o=n(o),o&&t.test(o)?o.replace(e,"\\$&"):o}return me=a,me}var Qr=Jr();const or=tr(Qr),zr=r.defineComponent({__name:"ItemLookup",props:{label:{},placeholder:{},value:{},searchForItems:{},searchInput:{default:""},error:{default:null},itemSuggestions:{default:()=>[]},ariaRequired:{type:Boolean,default:!1}},emits:{"update:modelValue":n=>n===null||/^Q\d+$/.test(n.id),"update:searchInput":null},setup(n,{emit:e}){const t=n,a=e,o=r.ref(null),i=r.computed(()=>{const d=new RegExp(`\\b${or(t.searchInput)}`,"i");return t.itemSuggestions.filter(f=>{var h;return d.test(((h=f.display.label)==null?void 0:h.value)||"")})}),u=r.ref([]),s=r.computed(()=>{const d=[...i.value,...u.value.filter(f=>!i.value.some(h=>h.id===f.id))];return!d.length&&t.value&&d.push(t.value),d}),c=r.ref(null),l=d=>{c.value=d,a("update:modelValue",d)},m=d=>{const f=s.value.find(h=>h.id===d);return l(f!=null?f:null)},g=Wr(d=>I(this,null,function*(){u.value=yield t.searchForItems(d)}),150),p=r.ref(null),v=d=>{var h,M,$;if(p.value===d)return;p.value=d;const f=s.value.find(W=>{var U;return((U=W.display.label)==null?void 0:U.value)===d});if(d.trim()===""){u.value=[];return}d===((M=(h=c.value)==null?void 0:h.display.label)==null?void 0:M.value)||d===(($=c.value)==null?void 0:$.id)||(m((f==null?void 0:f.id)||null),g(d))},y=()=>I(this,null,function*(){const d=yield t.searchForItems(t.searchInput,u.value.length);u.value=[...u.value,...d]});function L(d){var f,h;return{label:((f=d.display.label)==null?void 0:f.value)||d.id,description:((h=d.display.description)==null?void 0:h.value)||"",value:d.id}}const C=r.computed(()=>s.value.map(L)),R=T(),w={visibleItemLimit:6,boldLabel:!0},_=r.computed(()=>t.error?t.error.type:"default"),b=r.computed(()=>{if(t.error){if(t.error.type==="error")return{error:t.error.message};if(t.error.type==="warning")return{warning:t.error.message}}return{}}),S=k.useModelWrapper(r.toRef(t,"searchInput"),a,"update:searchInput");return(d,f)=>(r.openBlock(),r.createBlock(r.unref(k.CdxField),{status:_.value,messages:b.value},{label:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(d.label),1),d.ariaRequired?(r.openBlock(),r.createBlock(j,{key:0})):r.createCommentVNode("",!0)]),default:r.withCtx(()=>[r.createVNode(r.unref(k.CdxLookup),{selected:o.value,"onUpdate:selected":[f[0]||(f[0]=h=>o.value=h),m],"input-value":r.unref(S),"onUpdate:inputValue":f[1]||(f[1]=h=>r.isRef(S)?S.value=h:null),"aria-required":d.ariaRequired,placeholder:d.placeholder,"menu-items":C.value,"menu-config":w,onLoadMore:y,onInput:v},{"no-results":r.withCtx(()=>[r.createTextVNode(r.toDisplayString(r.unref(R).getUnescaped("wikibase-entityselector-notfound")),1)]),_:1},8,["selected","input-value","aria-required","placeholder","menu-items"])]),_:1},8,["status","messages"]))}}),ir=O(zr,[["__scopeId","data-v-3aae3495"]]),lr=Symbol("LanguageItemSearch");function Zr(){return r.inject(lr,()=>{throw new Error("No LanguageItemSearcher provided!")},!0)}const et={class:"wbl-snl-language-lookup"},rt=r.defineComponent({__name:"LanguageInput",props:{modelValue:{},searchInput:{}},emits:["update:modelValue","update:searchInput"],setup(n,{emit:e}){const t=n,a=e,o=T(),i=Zr(),u=i.searchItems.bind(i),s=N.useStore(),c=r.computed(()=>s.state.perFieldErrors.languageErrors.length?{type:"error",message:o.getUnescaped(s.state.perFieldErrors.languageErrors[0].messageKey)}:s.state.languageCodeFromLanguageItem!==!1?null:{type:"warning",message:o.getUnescaped("wikibaselexeme-newlexeme-invalid-language-code-warning")}),l=A(),m=k.useModelWrapper(r.toRef(t,"searchInput"),a,"update:searchInput");return(g,p)=>(r.openBlock(),r.createElementBlock("div",et,[r.createVNode(ir,{"search-input":r.unref(m),"onUpdate:searchInput":[p[0]||(p[0]=v=>r.isRef(m)?m.value=v:null),p[2]||(p[2]=v=>g.$emit("update:searchInput",v))],label:r.unref(o).getUnescaped("wikibaselexeme-newlexeme-language"),placeholder:r.unref(o).getUnescaped("wikibaselexeme-newlexeme-language-placeholder-with-example",r.unref(l).placeholderExampleData.languageLabel),value:g.modelValue,"search-for-items":r.unref(u),error:c.value,"aria-required":!0,"onUpdate:modelValue":p[1]||(p[1]=v=>g.$emit("update:modelValue",v))},{suffix:r.withCtx(()=>[r.createVNode(j)]),_:1},8,["search-input","label","placeholder","value","search-for-items","error"])]))}}),ur=Symbol("LanguageCodesProvider");function tt(){return r.inject(ur,()=>{throw new Error("No LanguageCodesProvider provided!")},!0)}const nt={class:"wbl-snl-spelling-variant-lookup__help-link"},at=["href"],st=r.defineComponent({__name:"SpellingVariantInput",props:{searchInput:{default:""}},emits:{"update:modelValue":n=>n==null||typeof n=="string"&&n.length>0,"update:searchInput":null},setup(n,{emit:e}){const t=n,a=tt(),o=T(),i=[];a.getLanguages().forEach((_,b)=>{i.push({label:o.getUnescaped("wikibase-lexeme-lemma-language-option",_,b),value:b,description:""})});const u=r.ref([]),s=e,c=r.ref(null),l=_=>{if(c.value===_)return;if(c.value=_,s("update:searchInput",_),_.trim()===""){u.value=[];return}const b=new RegExp(`\\b${or(_)}`,"i");u.value=i.filter(S=>S.label&&b.test(S.label))},m=r.ref(null),g=_=>{const b=u.value.find(S=>S.value===_);s("update:modelValue",(b==null?void 0:b.value.toString())||void 0)},p=A(),v=N.useStore(),y=o.get("wikibaselexeme-newlexeme-lemma-language-help-link-target"),L=o.get("wikibaselexeme-newlexeme-lemma-language-help-link-text"),C=r.computed(()=>v.state.perFieldErrors.spellingVariantErrors.length?"error":"default"),R=r.computed(()=>v.state.perFieldErrors.spellingVariantErrors.length?{error:o.getUnescaped(v.state.perFieldErrors.spellingVariantErrors[0].messageKey)}:{}),w=k.useModelWrapper(r.toRef(t,"searchInput"),s,"update:searchInput");return(_,b)=>(r.openBlock(),r.createBlock(r.unref(k.CdxField),{class:"wbl-snl-spelling-variant-lookup",status:C.value,messages:R.value},{label:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(r.unref(o).getUnescaped("wikibaselexeme-newlexeme-lemma-language")),1),r.createVNode(j),r.createElementVNode("span",nt,[r.createElementVNode("a",{href:r.unref(y),target:"_blank"},r.toDisplayString(r.unref(L)),9,at)])]),default:r.withCtx(()=>[r.createVNode(r.unref(k.CdxLookup),{selected:m.value,"onUpdate:selected":[b[0]||(b[0]=S=>m.value=S),g],"input-value":r.unref(w),"onUpdate:inputValue":b[1]||(b[1]=S=>r.isRef(w)?w.value=S:null),placeholder:r.unref(o).getUnescaped("wikibaselexeme-newlexeme-lemma-language-placeholder-with-example",r.unref(p).placeholderExampleData.spellingVariant),"menu-items":u.value,onInput:l},{"no-results":r.withCtx(()=>[r.createTextVNode(r.toDisplayString(r.unref(o).getUnescaped("wikibase-entityselector-notfound")),1)]),_:1},8,["selected","input-value","placeholder","menu-items"])]),_:1},8,["status","messages"]))}}),ot={class:"wbl-snl-lexical-category-lookup"},it=r.defineComponent({__name:"LexicalCategoryInput",props:{modelValue:{},searchInput:{}},emits:["update:modelValue","update:searchInput"],setup(n){const e=T(),t=_r(),a=t.searchItems.bind(t),o=A(),i=o.lexicalCategorySuggestions,u=o.placeholderExampleData.lexicalCategoryLabel,s=N.useStore(),c=r.computed(()=>s.state.perFieldErrors.lexicalCategoryErrors.length?{type:"error",message:e.getUnescaped(s.state.perFieldErrors.lexicalCategoryErrors[0].messageKey)}:null);return(l,m)=>(r.openBlock(),r.createElementBlock("div",ot,[r.createVNode(ir,{label:r.unref(e).getUnescaped("wikibaselexeme-newlexeme-lexicalcategory"),placeholder:r.unref(e).getUnescaped("wikibaselexeme-newlexeme-lexicalcategory-placeholder-with-example",r.unref(u)),value:l.modelValue,"search-input":l.searchInput,"search-for-items":r.unref(a),"item-suggestions":r.unref(i),error:c.value,"aria-required":!0,"onUpdate:modelValue":m[0]||(m[0]=g=>l.$emit("update:modelValue",g)),"onUpdate:searchInput":m[1]||(m[1]=g=>l.$emit("update:searchInput",g))},{suffix:r.withCtx(()=>[r.createVNode(j)]),_:1},8,["label","placeholder","value","search-input","search-for-items","item-suggestions","error"])]))}}),lt=r.defineComponent({__name:"ErrorMessage",setup(n){return(e,t)=>(r.openBlock(),r.createBlock(r.unref(k.CdxMessage),{type:"error"},{default:r.withCtx(()=>[r.renderSlot(e.$slots,"default")]),_:3}))}}),cr=Symbol("UrlLauncher");function ut(){return r.inject(cr,()=>{throw new Error("No UrlLauncher provided!")},!0)}const ct={class:"wbl-snl-form"},dt=["innerHTML"],gt=["innerHTML"],mt=r.defineComponent({__name:"NewLexemeForm",setup(n){const e=A(),t=T(),a=N.useStore(),o=r.computed({get(){return a.state.lemma},set(d){a.commit(he,d),d.trim().length>0&&a.commit(P,"lemmaErrors")}}),i=r.computed({get(){return a.state.language},set(d){return I(this,null,function*(){yield a.dispatch(ze,d),d&&a.commit(P,"languageErrors")})}}),u=r.computed({get(){return a.state.languageSearchInput},set(d){a.commit(ve,d)}}),s=r.computed({get(){return a.state.lexicalCategory},set(d){a.commit(ye,d),d&&a.commit(P,"lexicalCategoryErrors")}}),c=r.computed({get(){return a.state.lexicalCategorySearchInput},set(d){a.commit(be,d)}}),l=r.computed(()=>a.state.languageCodeFromLanguageItem===null||a.state.languageCodeFromLanguageItem===!1),m=r.computed({get(){return a.state.spellingVariant},set(d){a.commit(D,d),d&&a.commit(P,"spellingVariantErrors")}}),g=r.computed({get(){return a.state.spellingVariantSearchInput},set(d){a.commit(xe,d)}}),p=r.ref(!1),v=t.getUnescaped("wikibaselexeme-newlexeme-submit"),y=t.getUnescaped("wikibaselexeme-newlexeme-submitting"),L=t.get("copyrightpage"),C=t.get("wikibase-shortcopyrightwarning",v,L,e.licenseUrl,e.licenseName),R=r.computed(()=>p.value?y:v),w=r.computed(()=>{if(a.state.globalErrors.length>0){const d=a.state.globalErrors[0];return d.message?d.message:t.getUnescaped("wikibaselexeme-newlexeme-submit-error")}return null}),_=ut(),b=()=>I(this,null,function*(){p.value=!0;try{const d=yield a.dispatch(Qe);yield _.goToURL(d)}catch(d){}p.value=!1});return(d,f)=>(r.openBlock(),r.createElementBlock("form",ct,[r.createVNode(Ur,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=h=>o.value=h)},null,8,["modelValue"]),r.createVNode(rt,{modelValue:i.value,"onUpdate:modelValue":f[1]||(f[1]=h=>i.value=h),"search-input":u.value,"onUpdate:searchInput":f[2]||(f[2]=h=>u.value=h)},null,8,["modelValue","search-input"]),l.value?(r.openBlock(),r.createBlock(st,{key:0,modelValue:m.value,"onUpdate:modelValue":f[3]||(f[3]=h=>m.value=h),"search-input":g.value,"onUpdate:searchInput":f[4]||(f[4]=h=>g.value=h)},null,8,["modelValue","search-input"])):r.createCommentVNode("",!0),r.createVNode(it,{modelValue:s.value,"onUpdate:modelValue":f[5]||(f[5]=h=>s.value=h),"search-input":c.value,"onUpdate:searchInput":f[6]||(f[6]=h=>c.value=h)},null,8,["modelValue","search-input"]),r.createElementVNode("p",{class:"wbl-snl-copyright",innerHTML:r.unref(C)},null,8,dt),w.value?(r.openBlock(),r.createBlock(lt,{key:1},{default:r.withCtx(()=>[r.createElementVNode("span",{innerHTML:w.value},null,8,gt)]),_:1})):r.createCommentVNode("",!0),r.createElementVNode("div",null,[r.createVNode(r.unref(k.CdxButton),{class:"form-button-submit",action:"progressive",weight:"primary",type:"submit",disabled:p.value,onClick:r.withModifiers(b,["prevent"])},{default:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(R.value),1)]),_:1},8,["disabled"])])]))}}),pt=O(mt,[["__scopeId","data-v-4068cc25"]]),ft=["innerHTML"],ht=r.defineComponent({__name:"SearchExisting",setup(n){const e=T(),t=wr(),a=N.useStore(),o=r.computed(()=>{const u=a.state.lemma;return t.getSearchUrlForLexeme(u)}),i=r.computed(()=>e.get("wikibaselexeme-newlexeme-search-existing",o.value));return(u,s)=>(r.openBlock(),r.createElementBlock("p",{class:"wbl-snl-search-existing",innerHTML:i.value},null,8,ft))}}),vt=O(ht,[["__scopeId","data-v-066a8c87"]]),yt={class:"wbl-snl-app"},bt=r.defineComponent({__name:"App",setup(n){return(e,t)=>(r.openBlock(),r.createElementBlock(r.Fragment,null,[(r.openBlock(),r.createBlock(r.Teleport,{to:"#wbl-snl-intro-text-wrapper"},[r.createVNode(vt),r.createVNode(Rr)])),r.createElementVNode("div",yt,[r.createVNode(pt)])],64))}});class xt{constructor(e){E(this,"validLanguages");this.validLanguages=e}getLanguages(){return this.validLanguages}isValid(e){return this.validLanguages.has(e)}}function _t(n,e){const t=r.createApp(bt),a=new xt(n.wikibaseLexemeTermLanguages),o=Ir(K(B({},e),{languageCodesProvider:a}));return t.use(o),n.initParams!==void 0&&o.dispatch(Ze,n.initParams),t.provide(He,n),t.provide(rr,new er(e.messagesRepository)),t.provide(We,e.itemSearcher),t.provide(lr,e.languageItemSearcher),t.provide(Ke,e.searchLinker),t.provide(Xe,e.authenticationLinker),t.provide(cr,e.urlLauncher),t.provide(ur,a),t.mount(n.rootSelector)}class wt{constructor(e,t,a=[]){E(this,"api");E(this,"getUrl");E(this,"tags");this.api=e,this.getUrl=t,this.tags=a}createLexeme(e,t,a,o){return I(this,null,function*(){const i=this.api.assertCurrentUser({action:"wbeditentity",new:"lexeme",tags:this.tags,data:JSON.stringify({lemmas:{[t]:{language:t,value:e}},language:a,lexicalCategory:o}),errorformat:"html",formatversion:2}),s=yield this.api.postWithEditToken(i).catch((l,m,g)=>{let p;try{g&&g.errors?p=g.errors.map(v=>{const y={type:v.code};return v.html&&(y.message=v.html),y}):p=[{type:l}]}catch(v){console.error("Unexpected API result",g,v),p=[{type:"assertionerror"}]}return Promise.reject(p)}),c=window.location.href;return s.tempuserredirect?new URL(s.tempuserredirect,c):new URL(this.getUrl(`Special:EntityPage/${s.entity.id}`),c)})}}class St{constructor(e){E(this,"mwMessages");this.mwMessages=e}get(e,...t){return this.mwMessages(e,...t).parse()}getText(e,...t){return this.mwMessages(e,...t).text()}}class Et{goToURL(e){return window.location.href=e.toString(),new Promise(t=>{})}}function De(n){var e,t;switch(n.mainsnak.snaktype){case"value":break;case"somevalue":return!1;case"novalue":return null;default:throw new Error(`Unexpected snak type ${n.mainsnak.snaktype}!`)}if(((e=n.mainsnak.datavalue)==null?void 0:e.type)!=="string")throw new Error(`Expected ${n.mainsnak.property} to have DataValueType "string" but got "${(t=n.mainsnak.datavalue)==null?void 0:t.type}"!`);return n.mainsnak.datavalue.value}function Lt(n,e){if(!n.claims[e])return null;const t=n.claims[e].filter(o=>o.rank==="preferred");if(t.length!==0)return De(t[0]);const a=n.claims[e].filter(o=>o.rank==="normal");return a.length!==0?De(a[0]):null}class It{constructor(e,t){E(this,"api");E(this,"languageCodeProperty");this.api=e,this.languageCodeProperty=t}getLanguageCodeFromItem(e){return I(this,null,function*(){if(!this.languageCodeProperty)return null;const t=yield this.api.get({action:"wbgetclaims",entity:e,property:this.languageCodeProperty,props:""}).catch((a,o,i)=>(console.warn(`Error while retrieving language code in ${this.languageCodeProperty} for item ${e}: ${a}`,i),!1));return t===!1?!1:Lt(t,this.languageCodeProperty)})}}class kt{constructor(e,t){E(this,"LANGUAGE_PROFILE_NAME","language");E(this,"itemSearcher");E(this,"useLanguageProfile");this.itemSearcher=e,this.useLanguageProfile=t.includes(this.LANGUAGE_PROFILE_NAME)}searchItems(e,t){return I(this,null,function*(){const a={};return this.useLanguageProfile&&(a.profile=this.LANGUAGE_PROFILE_NAME),this.itemSearcher.searchItems(e,t,a)})}}class Ct{constructor(e,t){this.getUrl=e,this.currentPage=t}getCreateAccountLink(){return this.getUrl("Special:CreateAccount",{returnto:this.currentPage})}getLoginLink(){return this.getUrl("Special:UserLogin",{returnto:this.currentPage})}}function Tt(n,e){const t=e.config.get("wgUserLanguage"),a=new e.Api({parameters:{formatversion:2,uselang:t,errorformat:"html"}}),o=new yr(a,t),i=new kt(o,n.availableSearchProfiles),u=new It(a,e.config.get("LexemeLanguageCodePropertyId")),s=new St(e.message),c=new wt(a,e.util.getUrl,n.tags),l=new br(e.util.getUrl,e.config.get("wgNamespaceIds").lexeme),m=new Ct(e.util.getUrl,e.config.get("wgPageName")),g=new xr(e.track),p=new Et;return _t(n,{itemSearcher:o,languageItemSearcher:i,langCodeRetriever:u,messagesRepository:s,lexemeCreator:c,searchLinker:l,authenticationLinker:m,tracker:g,urlLauncher:p})}module.exports=Tt;
